# Attendees Spreadsheet Redesign — Summary

## Project Understanding

CatLab Drinks is a bar automation / POS system built with Laravel (backend) and Vue.js (frontend). It supports three frontend apps (Manage, POS, Client) sharing one Laravel backend with two API layers (Management API and Device API).

### Attendees Module
The attendees module allows event organisers to register "card aliases" with NFC cards and associate them with personal information (name, email). This is primarily used to link NFC cards to tokens generated by QuizWitz quiz software, enabling quizzers to spend credit from their NFC card without physically scanning it (for remote orders). The alias is a secret known only to the card owner, as it grants access to spending credit. To actually link a card to an alias, the organiser must check in the attendee using the Check-In module (CheckIn.vue). Only after check-in is the alias linked to the NFC card. Aliases expire after 24 hours.

### Key Files
- **Model**: `app/Models/Attendee.php` — fields: `name`, `alias`, `email`, belongs to `Event`
- **Controller**: `app/Http/ManagementApi/V1/Controllers/AttendeeController.php` — uses Charon's `ChildCrudController` trait
- **Resource Definition**: `app/Http/ManagementApi/V1/ResourceDefinitions/AttendeeResourceDefinition.php` — defines API field visibility
- **Policy**: `app/Policies/AttendeePolicy.php` — authorization checks
- **Frontend Service**: `resources/shared/js/services/EventService.js` — API communication
- **Frontend View**: `resources/shared/js/views/Attendees.vue` — the attendee-specific page
- **Reusable Component**: `resources/shared/js/components/Spreadsheet.vue` — generic spreadsheet component

## Changes Made

### Backend
1. **AttendeeController**: Expanded route registration from `['index', 'view']` to `['index', 'view', 'store', 'edit', 'destroy']` to enable individual attendee CRUD operations.
2. **AttendeeController**: Added `bulkDestroy()` method — accepts `DELETE /events/{parentId}/attendees` with a JSON body `{ "ids": [...] }` and `X-Bulk-Request` header to delete multiple attendees at once.
3. **AttendeePolicy**: Fixed `view`, `edit`, and `destroy` methods that incorrectly referenced `MenuItem` instead of `Attendee`.

### Frontend — Reusable Spreadsheet Component
4. **Spreadsheet.vue** (`resources/shared/js/components/Spreadsheet.vue`): New abstract, reusable spreadsheet component:
   - Accepts `columns` (array of `{ key, label }`) and `rows` as props
   - Arrow key, Tab/Shift+Tab, Enter navigation between cells
   - Paste import dialog: auto-detects delimiters (`:` for first column, tab for others), allows user to select delimiters, shows preview of parsed data before importing
   - Handles the QuizWitz format `alias: Name\tEmail` by default
   - Delete/undo-delete buttons, dirty tracking, empty row management
   - Emits `save` and `reset` events for parent to handle

### Frontend — Attendees Page
5. **Attendees.vue**: Refactored to use the reusable Spreadsheet component, keeping only attendee-specific logic (loading data, save operations).
6. **EventService**: Added `bulkCreateAttendees()` and `bulkDeleteAttendees()` methods that use `X-Bulk-Request` header. Bulk create sends `{ "items": [...] }` via POST; bulk delete sends `{ "ids": [...] }` via DELETE.

### Documentation
7. **`.ai/charon-bulk-delete-instructions.md`**: Instructions for extending the Charon framework to support bulk delete natively, including proposed code changes for `CrudController`, `ChildCrudController`, route registration, and frontend usage patterns.
